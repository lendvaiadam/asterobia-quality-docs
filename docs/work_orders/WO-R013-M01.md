# WORK ORDER: R013-M01 Message Types & Serializer

**Target Worker**: Backend
**Parent Branch**: `work/WO-R013`
**Worker Branch**: `work/WO-R013-backend`

**CTO Escalation**: Not Required (Pre-approved in CTO Ping #1)
**Escalation Triggers**:
- [ ] Spec Ambiguity
- [ ] Architecture Change
- [ ] Determinism Risk

## 1. Context
R013 Multiplayer Handshake requires standardized message schemas for Host-Guest communication. This task creates the message type constants and encode/decode utilities as the foundation for all network messaging.

## 2. In-Scope Files (Whitelist)
- `src/SimCore/multiplayer/MessageTypes.js` (CREATE)
- `src/SimCore/multiplayer/MessageSerializer.js` (CREATE)
- `src/SimCore/__tests__/messageSerializer.test.js` (CREATE)

## 3. Strict Out-of-Scope (Blacklist)
- `src/Main.js` (Never touch entry point)
- `src/Core/Game.js` (Not yet - M03)
- `package.json` (No dependency changes)
- Any existing transport files (M04 scope)

## 4. Acceptance Criteria ("Done When")
- [ ] `MessageTypes.js` exports MSG constants for all 11 message types (HELLO, HOST_ANNOUNCE, JOIN_REQ, JOIN_ACK, INPUT_CMD, CMD_BATCH, SNAPSHOT, RESYNC_REQ, RESYNC_ACK, PING, PONG)
- [ ] `MessageSerializer.js` exports `encode(obj)` and `decode(str)` functions
- [ ] Schema validation rejects malformed messages
- [ ] Unit tests pass: `npm test -- messageSerializer`
- [ ] Linter is green

## 5. Antigravity Decision Log
**2026-02-04**: CTO Ping #1 APPROVED. Proceed with M01+M02 parallelizable work.

## 6. Reference
- Spec: `docs/specs/R013_MULTIPLAYER_HANDSHAKE_HOST_AUTHORITY.md` Section 4 (Message Schemas)
- Tasklist: `docs/specs/R013_IMPLEMENTATION_TASKLIST.md` Section M01
